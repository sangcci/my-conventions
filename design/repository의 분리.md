# Appender? Updater? CQRS?

우리가 만드는 대부분의 프로젝트는 CURD를 가지고 있다. 

이들을 각각 CRUD를 기준으로 세분화한다면 어떻게 될까?

책임의 분리로 인해 Appender는 데이터의 INSERT만을, Updater는 데이터의 UPDATE만을 담당하게 된다.

자연스레 이는 인터페이스로 만들면서 이들만의 명세가 만들어진다.

책임을 세분화 할 수록 무언가 읽히기 좋은 느낌이 들었다.

하지만 단순히 가독성 그 이상의 효과가 무엇인지 알아야 한다.

### 오해

Service는 분리할 필요가 없다. 

Service는 그 자체로 명세이다. service를 다른 코드로 대체할 가능성은 거의 없으며, 그런 상황이 발생하면 안된다. 확장성을 위한 코드나, 유지보수를 위한 설계를 하기 보다는, 해당 기능의 명세로써 기능을 할 수 있도록 도우는 것이 중요하다고 생각한다.

그래서 service는 단순히 우리가 가독성을 위해서 분리한다는 목적이라면 가능하지만, 나머지 이유로 분리를 할 필요는 없다고 생각한다.

### 외부와의 통신

중요한 점은 외부와의 통신에서의 분리이다.

Service에서 create, get, update, delete 등의 작업을 한다고 해서 service를 기준으로 분리하지 않는다.

결국 이 작업은 영속화할 수 있는 역할로 분리해서 생각해야 한다.

- service는 여러 비즈니스 로직 등을 포함하는, 사용자가 수행하는 기능 단위의 명세이다.
- repository 등의 외부 모듈과 연결될 수 있는, 그리고 다른 기술로 대체 가능성이 있는 역할의 경우에는 비즈니스 로직 중 한가지로 분류한 별도의 역할이다.

이렇게 분리해서 의존성을 주입하여 service에서 사용하게 하는 것이 일반적인 설계.

여기서 더 생각할 수 있는 것이 바로 CQRS.

# 인터페이스 분리

- 영향 범위
- 의존성
- 확장성

SOLID의 인터페이스 분리 법칙, 단일 책임 원칙을 떠올려보면, 위 CRUD를 모두 가지고 있는 repository 코드는 여러 책임을 가진다고 해석할 수 있고 
이는 영향 범위를 알기 어려워져 코드 변경 자체가 어려워지는 현상이 발생한다.

controller와 service는 간단한 프로젝트라면 메서드가 1대 1로 연결되는 것이 대부분이지만, 조금만 요구사항이 추가되거나 기능이 추가되어도 여러 클래스와 엮여야 될 것이다.

여러 클래스와 연계될 경우 1개의 Service에 대한 변경이 확장될 수 있다. 이는 의존성의 방향을 그려보면 알 수 있다.

생각해보면, repository는 데이터 CRUD에 대한 행위, 즉 책임은 거의 고정되어 있다. 

### 기능적 응집도

흔히 응집도가 높아지기 위해서는 '한 곳으로 모은다' 라는 인식이 강하다.

하지만 오히려 '분리'를 통해 응집도를 높일 수 있는데, 이 경우가 기능적 응집도이다.

응집도 단계를 확인하기 위해서 다음 링크를 참고하자.
[Cohesion (computer science) - wikipedia](https://en.wikipedia.org/wiki/Cohesion_(computer_science))

응집도의 단계 중에서도 기능적 응집도가 가장 높다고 평가받는다.

CQRS도 이를 지키는 사례 중 한개라도 볼 수 있다. 역할을 세세하게 분리함으로써 '기능적 응집도'를 지켰다.

### 모든 것은 환경에 맞게

재사용성을 높이기 위해 Repository를 Appender, Updater 등으로 분리하는 작업이 과연 현재 진행하는 프로젝트에 적합할지 고민해야 한다.

- 간단한 로직을 작성하는 것이라면 Repository 구현만으로 끝낼 수 있다. 어쩌면 JPA가 제공하는 repository interface만을 이용해서 구현해도 문제없다.
- 프로젝트의 규모가 커져서 다른 DB를 복수로 사용하거나, 세세한 저장 기능 등을 구현해야 한다면, 역할을 분리해서 최대한 하나의 책임을 가지게 하는 것이 좋다.

는 결론을 내렸다. 

---

[자바/스프링 개발자를 위한 실용주의 프로그래밍](https://product.kyobobook.co.kr/detail/S000213447953)
