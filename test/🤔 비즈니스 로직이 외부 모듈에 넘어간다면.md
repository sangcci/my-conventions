# 비즈니스 로직 외부 모듈

'오늘 이미 출결을 등록했다면 더는 등록할 수 없다' 라는 요구사항이 있다.

이를 외부 모듈인 `repository`에게 맡기게 될 경우,

```java
private void validateAlreadyRegistToday(User register) {
    attendanceRepository.findByUserIdAndStartAt(register.getId(), dateTimeHolder.getDate())
            .ifPresent(attendance -> {
                throw new AppException(REQUEST_ALREADY_EXISTS);
            });
}
```

다음과 같이 `mock`을 활용하여 테스트가 통과되었음을 명시해야 한다.

```java
when(attendanceRepository.findByUserIdAndStartAt(user.getId(), dateTimeHolder.getDate())).thenReturn(Optional.empty());
```

1. 서비스 내부 로직이 밖으로 드러난다.
2. 해당 로직은 repository 단위 테스트로 해결할 수 있지만, 시간이 오래 걸린다는 단점이 존재한다.

